---
- name: Check if SafetyScan is already installed
  stat:
    path: "{{ safetyscan_bin_dir }}/safetyscan"
  register: safetyscan_check

- name: Display installation status
  debug:
    msg: "SafetyScan is already installed. Skipping installation."
  when: 
    - safetyscan_check.stat.exists
    - not safetyscan_force_install

- name: Install Docker
  include_tasks: install-docker.yml
  when: safetyscan_install_docker
  tags: docker

- name: Install SafetyScan
  include_tasks: install-safetyscan.yml
  when: not safetyscan_check.stat.exists or safetyscan_force_install
  tags: install

- name: Verify installation
  command: "{{ safetyscan_bin_dir }}/safetyscan --help"
  register: verify_install
  changed_when: false
  failed_when: verify_install.rc != 0

- name: Display success message
  debug:
    msg: |
      âœ“ SafetyScan installation complete!
      
      Run scans with:
        safetyscan /path/to/project --mode sast
        safetyscan /path/to/project --mode dast --start "npm start" --port 3000
        safetyscan /path/to/project --mode both --start "npm start" --port 3000